<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç«¶é¦¬ã‚²ãƒ¼ãƒ ï¼ˆæ”¹å–„æ¸ˆã¿å®Œæˆç‰ˆï¼‰</title>
<style>
Â Â body{font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;background:#f4f4f4;margin:0;padding:12px;color:#111}
Â Â h2{margin:0 0 10px;background:#0b8f3c;color:#fff;padding:10px;border-radius:12px}
Â Â .box{background:#fff;border:1px solid #ddd;border-radius:12px;padding:10px;margin:10px 0}
Â Â .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
Â Â button{border:0;border-radius:10px;padding:10px 12px;background:#0b8f3c;color:#fff;font-weight:900}
Â Â button.secondary{background:#333}
Â Â button:disabled{opacity:.45}
Â Â select,input{border:1px solid #ccc;border-radius:10px;padding:8px}
Â Â .muted{color:#666;font-size:13px;line-height:1.5}
Â Â .tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #cfe6ff;background:#eef6ff;color:#0a4a8a;margin-left:6px}
Â Â .bad{border-color:#ffb3b3;background:#ffecec;color:#7a0000}
Â Â .ok{border-color:#b9f2b9;background:#eaffea;color:#0b5a0b}
Â Â .table{width:100%;border-collapse:collapse;font-size:14px}
Â Â .table th,.table td{border-bottom:1px solid #eee;padding:6px 6px;text-align:left;vertical-align:top}
Â Â .table th{background:#f2f2f2}
Â Â .right{text-align:right}
Â Â pre{white-space:pre-wrap;background:#111;color:#eee;border-radius:12px;padding:10px;overflow:auto}

Â Â /* â˜…è¦‹ã‚„ã™ã•ï¼šé¦¬åŒå£«ã®é–“éš”ã‚’å°ã•ã */
Â Â #race{display:grid;gap:4px;max-height:55vh;overflow:auto}
Â Â .laneBox{background:#fff;border:1px solid #ddd;border-radius:12px;padding:6px}
Â Â .track{
Â Â Â Â position:relative;height:30px;border-radius:12px;overflow:hidden;margin-top:4px;
Â Â Â Â background:linear-gradient(#141414,#101010),
Â Â Â Â Â Â repeating-linear-gradient(90deg, rgba(255,255,255,.08) 0 1px, transparent 1px 72px);
Â Â Â Â background-size:100% 100%,72px 100%;
Â Â Â Â background-position:0 0,var(--bgx,0px) 0;
Â Â }
Â Â .finish{position:absolute;right:10px;top:0;width:3px;height:100%;background:#fff;opacity:.85}
Â Â .horse{
Â Â Â Â position:absolute;left:0%;top:5px;font-size:16px;user-select:none;transform-origin:center;
Â Â Â Â filter:drop-shadow(0 2px 2px rgba(0,0,0,.35));
Â Â }
Â Â .label{
Â Â Â Â position:absolute;left:0%;top:-1px;transform:translate(-4px,-10px);
Â Â Â Â font-size:11px;font-weight:900;color:#fff;background:rgba(0,0,0,.55);
Â Â Â Â border:1px solid rgba(255,255,255,.25);padding:2px 6px;border-radius:999px;
Â Â Â Â white-space:nowrap;
Â Â }
</style>
</head>
<body>
<h2>ğŸ‡ ç«¶é¦¬ã‚²ãƒ¼ãƒ ï¼ˆæ”¹å–„æ¸ˆã¿å®Œæˆç‰ˆï¼‰</h2>

<div class="box">
Â Â <div class="row">
Â Â Â Â <button id="btnCard" onclick="makeCard()">å‡ºèµ°è¡¨ï¼ˆã‚ªãƒƒã‚ºï¼‰ã‚’ä½œã‚‹</button>
Â Â Â Â <button id="btnStart" class="secondary" onclick="startRace()" disabled>ãƒ¬ãƒ¼ã‚¹é–‹å§‹ï¼ˆç· åˆ‡ï¼‰</button>
Â Â Â Â <button class="secondary" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
Â Â </div>
Â Â <div class="muted" style="margin-top:8px">
Â Â Â Â âœ… æ”¹å–„ç‚¹ã¾ã¨ã‚<br>
Â Â Â Â ãƒ»ã‚ªãƒƒã‚ºï¼š<b>1äººæ°—â‰¤3.0</b>ï¼<b>10äººæ°—â‰¥150</b>ï¼ˆç¶­æŒï¼‰ï¼‹ ä¸‹ä½ãŒåŒã˜å€ç‡ã§å›ºã¾ã‚Šã«ãã„<br>
Â Â Â Â ãƒ»æ‰•ã„æˆ»ã—ï¼š<b>é–‹å§‹æ™‚ã«è³­ã‘é‡‘ã‚’å…ˆã«å¼•ã</b> â†’ çš„ä¸­ã—ãŸã‚‰ <b>è³­ã‘é‡‘Ã—å€ç‡</b> ã‚’å—ã‘å–ã‚‹ï¼ˆãƒªã‚¢ãƒ«å¯„ã‚Šï¼‰<br>
Â Â Â Â ãƒ»ãƒ¬ãƒ¼ã‚¹æ™‚é–“ï¼š<b>ã»ã¼15ç§’</b>ã§çµ‚ã‚ã‚‹ï¼ˆé¦¬ã”ã¨ã«â€œäºˆå®šã‚´ãƒ¼ãƒ«æ™‚é–“â€ã‚’ä½œã£ã¦é€²ã¾ã›ã‚‹ï¼‰<br>
Â Â Â Â ãƒ»å±¥æ­´ä¿å­˜ï¼šç›´è¿‘ãƒ¬ãƒ¼ã‚¹ã®çµæœã‚’ä¿å­˜ã€é¦¬ã®å‹åˆ©/é€£å‹ã‚‚ä¿å­˜ï¼ˆæ¬¡ãƒ¬ãƒ¼ã‚¹ã«å°‘ã—åæ˜ ï¼‰
Â Â Â Â <span id="hiddenTag" class="tag bad" style="display:none">ã‚¿ãƒ–ã‚’è£ã«ã™ã‚‹ã¨å‹•ããŒé…ããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™</span>
Â Â </div>
</div>

<div class="box" id="playersBox"></div>
<div class="box" id="raceInfo"></div>
<div class="box" id="oddsBox"></div>

<div class="box">
Â Â <h3 style="margin:0 0 8px">ğŸŸï¸ è³­ã‘ï¼ˆå˜å‹ / è¤‡å‹ï¼‰</h3>
Â Â <div id="betBox"></div>
Â Â <div id="lockedBox" class="muted"></div>
</div>

<div class="box">
Â Â <h3 style="margin:0 0 8px">ğŸ ãƒ¬ãƒ¼ã‚¹ï¼ˆå³ã«èµ°ã‚‹ãƒ»æ­¢ã¾ã‚‰ãªã„ï¼‰</h3>
Â Â <div id="race"></div>
</div>

<div class="box" id="historyBox"></div>

<pre id="log">å‡ºèµ°è¡¨ã‚’ä½œã£ã¦ã­ã€‚</pre>

<script>
/* =========================
Â Â Â è¨­å®š
========================= */
const N = 10;
const TARGET_SECONDS = 15;
const MIN_BET = 100;
const STEP = 100;
const STORAGE_KEY = "keiba_fixed_v2";
const HORSE_POOL_SIZE = 300;
const HISTORY_KEEP = 12;

/* =========================
Â Â Â ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
========================= */
const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
const rand=n=>Math.floor(Math.random()*n);
const yen=n=>Math.floor(n);
const nowStr=()=>new Date().toLocaleString();

/* =========================
Â Â Â é¦¬åç”Ÿæˆ
========================= */
const syll=["ã‚µãƒ³","ãƒ©ã‚¤","ãƒ–ãƒ¬","ãƒ•ã‚¡","ãƒ‰","ãƒ«","ã‚«","ã‚°","ãƒ´","ãƒŠ","ãƒˆ","ã‚­","ãƒ©","ã‚¹","ã‚»ã‚¤","ãƒ¦ã‚¦","ã‚ªã‚¦","ã‚·ãƒ³","ãƒãƒ«","ãƒ†ãƒ„","ãƒ’ãƒ¡","ã‚¼ãƒ³","ãƒŸãƒ¤","ã‚¢ã‚­","ãƒ›ã‚·","ã‚«ã‚¼","ãƒ„ã‚­","ãƒ¦ãƒ¡"];
function genName(){
Â Â let s=""; const parts=2+rand(2);
Â Â for(let i=0;i<parts;i++) s+=syll[rand(syll.length)];
Â Â return s;
}
function uniqueNames(n){
Â Â const set=new Set();
Â Â while(set.size<n) set.add(genName());
Â Â return [...set];
}

/* =========================
Â Â Â ä¿å­˜ãƒ‡ãƒ¼ã‚¿
Â Â Â - players
Â Â Â - horsePool(300): {id,name,basePower,wins,streak,runs}
Â Â Â - history: ç›´è¿‘ãƒ¬ãƒ¼ã‚¹
========================= */
let state = {
Â Â players: [
Â Â Â Â {name:"P1", money:1500, dead:false},
Â Â Â Â {name:"P2", money:1500, dead:false},
Â Â Â Â {name:"P3", money:1500, dead:false},
Â Â ],
Â Â horsePool: [],
Â Â history: []
};

function save(){
Â Â try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
}
function load(){
Â Â try{
Â Â Â Â const raw=localStorage.getItem(STORAGE_KEY);
Â Â Â Â if(!raw) return;
Â Â Â Â const d=JSON.parse(raw);
Â Â Â Â if(d?.players) state.players=d.players;
Â Â Â Â if(d?.horsePool) state.horsePool=d.horsePool;
Â Â Â Â if(d?.history) state.history=d.history;
Â Â }catch(e){}
}
load();

/* åˆå›ï¼šé¦¬300é ­ã‚’ä½œã‚‹ */
function ensureHorsePool(){
Â Â if(Array.isArray(state.horsePool) && state.horsePool.length===HORSE_POOL_SIZE) return;
Â Â const names=uniqueNames(HORSE_POOL_SIZE);
Â Â state.horsePool = Array.from({length:HORSE_POOL_SIZE}, (_,i)=>({
Â Â Â Â id:i,
Â Â Â Â name:names[i],
Â Â Â Â basePower: 1.2 + Math.random()*8.5, // å€‹ä½“å·®
Â Â Â Â wins:0,
Â Â Â Â streak:0,
Â Â Â Â runs:0
Â Â }));
Â Â save();
}
ensureHorsePool();

/* =========================
Â Â Â UI
========================= */
function drawPlayers(){
Â Â const ps=state.players;
Â Â let html=`<h3 style="margin:0 0 8px">ğŸ’° æ‰€æŒé‡‘</h3>`;
Â Â ps.forEach(p=>{
Â Â Â Â const tag=(p.money<=0||p.dead)?`<span class="tag bad">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</span>`:`<span class="tag ok">å‚åŠ ä¸­</span>`;
Â Â Â Â html+=`<div>${p.name}ï¼š<b>${p.money}</b>å†† ${tag}</div>`;
Â Â });
Â Â document.getElementById("playersBox").innerHTML=html;
}

function renderRaceInfo(dist){
Â Â document.getElementById("raceInfo").innerHTML=
Â Â Â Â `<h3 style="margin:0 0 8px">ğŸ“Œ ãƒ¬ãƒ¼ã‚¹æ¡ä»¶</h3>
Â Â Â Â Â è·é›¢ï¼š<b>${dist}m</b> <span class="tag">ç´„${TARGET_SECONDS}ç§’</span>`;
}

function renderHistory(){
Â Â const h=state.history.slice(-HISTORY_KEEP).reverse();
Â Â if(!h.length){
Â Â Â Â document.getElementById("historyBox").innerHTML = `<h3 style="margin:0 0 8px">ğŸ§¾ ãƒ¬ãƒ¼ã‚¹å±¥æ­´</h3><div class="muted">ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
Â Â Â Â return;
Â Â }
Â Â let html=`<h3 style="margin:0 0 8px">ğŸ§¾ ãƒ¬ãƒ¼ã‚¹å±¥æ­´ï¼ˆæœ€æ–°${Math.min(HISTORY_KEEP, state.history.length)}ä»¶ï¼‰</h3>`;
Â Â html += `<table class="table"><thead><tr><th>æ—¥æ™‚</th><th>1ç€</th><th>2ç€</th><th>3ç€</th><th>ãƒ¡ãƒ¢</th></tr></thead><tbody>`;
Â Â h.forEach(r=>{
Â Â Â Â html += `<tr>
Â Â Â Â Â Â <td>${r.when}</td>
Â Â Â Â Â Â <td>${r.top3[0]}</td>
Â Â Â Â Â Â <td>${r.top3[1]}</td>
Â Â Â Â Â Â <td>${r.top3[2]}</td>
Â Â Â Â Â Â <td>${r.note}</td>
Â Â Â Â </tr>`;
Â Â });
Â Â html += `</tbody></table>`;
Â Â document.getElementById("historyBox").innerHTML = html;
}
drawPlayers();
renderHistory();

/* =========================
Â Â Â ç¾åœ¨ã®ãƒ¬ãƒ¼ã‚¹
========================= */
let race = {
Â Â dist: 1600,
Â Â horses: [],Â Â Â Â Â Â Â Â Â Â // ãƒ¬ãƒ¼ã‚¹å‡ºèµ°10é ­ï¼ˆpool indexå‚ç…§ã‚’å«ã‚€ï¼‰
Â Â cardReady:false,
Â Â bettingClosed:false,
Â Â lockedBets: [],Â Â Â Â Â Â // {pi,type,horseId,stake,odd,horseLabel}
Â Â finishPlan: [],Â Â Â Â Â Â // horseId -> finishTimeSec
Â Â finishOrder: [],Â Â Â Â Â // ids in finish
Â Â raf: null,
Â Â startT: null,
Â Â lastT: null,
Â Â bgx: 0,
Â Â maxFinish: TARGET_SECONDS,
};

/* =========================
Â Â Â ã‚ªãƒƒã‚ºæ”¹å–„
Â Â Â - æ¡ä»¶ç¶­æŒï¼š1äººæ°—<=3.0ã€10äººæ°—>=150
Â Â Â - å·®ãŒé–‹ãã™ããªã„ï¼š10äººæ°—ã¯150ã€œ220ç¨‹åº¦
Â Â Â - ä¸‹ä½ãŒå›ºã¾ã‚‰ãªã„ï¼šäººæ°—é †ä½ã§â€œæœ€å°å·®â€ã‚’å…¥ã‚Œã¦å˜èª¿å¢—åŠ ã‚’ä¿è¨¼
========================= */
function makeOddsForRace(horses){
Â Â // å®ŸåŠ›ã‚¹ã‚³ã‚¢ï¼ˆé€£å‹ã‚’å°‘ã—åæ˜ ï¼‰
Â Â const scores = horses.map(h=>{
Â Â Â Â const streakBoost = 1 + Math.min(0.12, h.streak*0.03); // é€£å‹ã¯æœ€å¤§+12%
Â Â Â Â const jitter = (Math.random()*2-1)*0.20;
Â Â Â Â return Math.log(h.power*streakBoost) + jitter;
Â Â });
Â Â const rank = [...horses.keys()].sort((a,b)=>scores[b]-scores[a]); // å¼·ã„é †

Â Â // æ¡ä»¶
Â Â const FAV_MAX=3.0;
Â Â const LAST_MIN=150.0;
Â Â const last = LAST_MIN + Math.random()*70; // 150ã€œ220ï¼ˆå·®ã‚’é–‹ãã™ããªã„ï¼‰
Â Â const favÂ Â = 2.0 + Math.random()*1.0;Â Â Â Â Â // 2.0ã€œ3.0
Â Â const midÂ Â = 26Â Â + Math.random()*28;Â Â Â Â Â Â // 26ã€œ54

Â Â const pow=1.22;
Â Â const jitter = ()=>Math.exp((Math.random()*2-1)*0.10); // ã»ã©ã»ã©æ•£ã‚Š

Â Â // ã¾ãšã‚«ãƒ¼ãƒ–ã§ä½œã‚‹
Â Â let byRank = new Array(horses.length).fill(0); // rankPos -> odd
Â Â for(let r=0;r<10;r++){
Â Â Â Â const t=r/9;
Â Â Â Â const a=Math.pow(mid/fav, Math.pow(t, pow));
Â Â Â Â const b=Math.pow(last/mid, Math.pow(t, pow+0.22));
Â Â Â Â let odd = fav*a*b*jitter();

Â Â Â Â // æ¡ä»¶å›ºå®š
Â Â Â Â if(r===0) odd=Math.min(FAV_MAX, odd);
Â Â Â Â if(r===9) odd=Math.max(LAST_MIN, odd);

Â Â Â Â byRank[r]=odd;
Â Â }

Â Â // â˜…å›ºã¾ã‚Šé˜²æ­¢ï¼šå˜èª¿å¢—åŠ ï¼‹æœ€å°å·®ã‚’ä¿è¨¼ï¼ˆå·®ã¯å¤§ããã—ã™ããªã„ï¼‰
Â Â // æœ€å°å·®ï¼šä¸Šä½ã¯+0.2ã€ä¸‹ä½ã¯+6ãã‚‰ã„
Â Â for(let r=1;r<10;r++){
Â Â Â Â const minGap = (r<=2)?0.2 : (r<=5)?1.5 : (r<=7)?4.0 : 6.0;
Â Â Â Â byRank[r] = Math.max(byRank[r], byRank[r-1] + minGap);
Â Â }

Â Â // æœ€å¾Œã®æ¡ä»¶ã‚’ã‚‚ã†ä¸€å›
Â Â byRank[0] = Math.min(FAV_MAX, byRank[0]);
Â Â byRank[9] = Math.max(LAST_MIN, byRank[9]);

Â Â // ranké †ã®oddã‚’ã€horseé…åˆ—ã¸å‰²å½“ï¼ˆå¼·ã„ã»ã©ä½ã‚ªãƒƒã‚ºï¼‰
Â Â rank.forEach((hid, rpos)=>{
Â Â Â Â horses[hid].winOdd = Number(clamp(byRank[rpos], 1.1, 999.9).toFixed(1));
Â Â });

Â Â // è¤‡å‹ï¼šå˜å‹ã¨é€£å‹•ã—ã¤ã¤å·®ãŒé–‹ãã™ããªã„
Â Â const pop=[...horses].sort((a,b)=>a.winOdd-b.winOdd);
Â Â const rmap=new Map(); pop.forEach((h,i)=>rmap.set(h.id,i+1));
Â Â horses.forEach(h=>{
Â Â Â Â const r=rmap.get(h.id);
Â Â Â Â let po = 1 + (h.winOdd-1)*(0.26+Math.random()*0.10);
Â Â Â Â po *= (0.95+(r-1)*0.02);
Â Â Â Â po *= (0.95+Math.random()*0.08);
Â Â Â Â h.placeOdd = Number(clamp(po, 1.1, 35).toFixed(2));
Â Â });
}

/* =========================
Â Â Â å‡ºèµ°è¡¨ï¼ˆã‚ªãƒƒã‚ºè¡¨ï¼‰
========================= */
function renderOddsTable(){
Â Â const sorted=[...race.horses].sort((a,b)=>a.winOdd-b.winOdd);
Â Â let html=`<h3 style="margin:0 0 8px">ğŸ“Š ã‚ªãƒƒã‚ºï¼ˆäººæ°—é †ï¼‰</h3>
Â Â Â Â <table class="table"><thead><tr>
Â Â Â Â Â Â <th>äººæ°—</th><th>é¦¬ç•ª</th><th>é¦¬å</th><th class="right">å˜å‹</th><th class="right">è¤‡å‹</th><th class="right">é€£å‹</th>
Â Â Â Â </tr></thead><tbody>`;
Â Â sorted.forEach((h,i)=>{
Â Â Â Â html += `<tr>
Â Â Â Â Â Â <td>${i+1}</td><td>${h.id+1}</td><td>${h.name}</td>
Â Â Â Â Â Â <td class="right"><b>${h.winOdd}</b>å€</td>
Â Â Â Â Â Â <td class="right"><b>${h.placeOdd}</b>å€</td>
Â Â Â Â Â Â <td class="right">${h.streak}</td>
Â Â Â Â </tr>`;
Â Â });
Â Â html += `</tbody></table>`;
Â Â document.getElementById("oddsBox").innerHTML = html;
}

function horseOptions(){
Â Â // ç•ªå·é †ï¼ˆäººæ°—é †ã˜ã‚ƒãªã„ï¼‰
Â Â return race.horses.map(h=>`<option value="${h.id}">${h.id+1} ${h.name}ï¼ˆå˜${h.winOdd}/è¤‡${h.placeOdd}ï¼‰</option>`).join("");
}

/* =========================
Â Â Â è³­ã‘UI
Â Â Â - æ‰€æŒé‡‘ä»¥ä¸Šã¯è³­ã‘ã‚‰ã‚Œãªã„
Â Â Â - 1ã€œ99å††ã¯å…¨é¡è³­ã‘OK
Â Â Â - åˆæœŸãŒå…¨å“¡ã€Œ1ç•ªå˜å‹ã€ã«ãªã‚‰ãªã„ã‚ˆã†ã«3äººã§åˆ¥ã®åˆæœŸå€¤
========================= */
function minBetFor(m){ if(m<=0) return 0; return (m>=MIN_BET)?MIN_BET:m; }
function normalizeBet(m, v){
Â Â if(m<=0) return 0;
Â Â let x=Number(v); if(!Number.isFinite(x)||x<0) x=0;
Â Â const step=(m>=MIN_BET)?STEP:1;
Â Â x=Math.floor(x/step)*step;
Â Â if(x>m) x=m;
Â Â if(m>=MIN_BET){
Â Â Â Â if(x>0 && x<MIN_BET) x=MIN_BET;
Â Â Â Â if(x>m) x=0;
Â Â }else{
Â Â Â Â if(x>0 && x<m) x=m;
Â Â }
Â Â return x;
}

function distinctDefaults(){
Â Â const used=new Set();
Â Â const pickHorse=()=>{
Â Â Â Â let h=rand(N), g=0;
Â Â Â Â while(used.has(h) && g<80){ h=rand(N); g++; }
Â Â Â Â used.add(h);
Â Â Â Â return h;
Â Â };
Â Â return [
Â Â Â Â {horse:pickHorse(), type:Math.random()<0.5?"win":"place"},
Â Â Â Â {horse:pickHorse(), type:Math.random()<0.5?"win":"place"},
Â Â Â Â {horse:pickHorse(), type:Math.random()<0.5?"win":"place"},
Â Â ];
}

function renderBetUI(){
Â Â const ps=state.players;
Â Â const opts=horseOptions();
Â Â const defs=distinctDefaults();

Â Â let html="";
Â Â ps.forEach((p,pi)=>{
Â Â Â Â const dead=(p.money<=0||p.dead);
Â Â Â Â const disabled=(race.bettingClosed||dead)?"disabled":"";
Â Â Â Â const tag=race.bettingClosed?`<span class="tag bad">ç· åˆ‡</span>`:(dead?`<span class="tag bad">GO</span>`:`<span class="tag ok">å—ä»˜</span>`);
Â Â Â Â const defAmt=minBetFor(p.money);

Â Â Â Â html += `<div class="box" style="margin:8px 0">
Â Â Â Â Â Â <div><b>${p.name}</b>ï¼ˆæ‰€æŒé‡‘ï¼š${p.money}å††ï¼‰ ${tag}</div>
Â Â Â Â Â Â <div class="row" style="margin-top:6px">
Â Â Â Â Â Â Â Â <label>åˆ¸ç¨®
Â Â Â Â Â Â Â Â Â Â <select id="type${pi}" ${disabled}>
Â Â Â Â Â Â Â Â Â Â Â Â <option value="win"${defs[pi].type==="win"?" selected":""}>å˜å‹</option>
Â Â Â Â Â Â Â Â Â Â Â Â <option value="place"${defs[pi].type==="place"?" selected":""}>è¤‡å‹</option>
Â Â Â Â Â Â Â Â Â Â </select>
Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â Â Â <label>é¦¬
Â Â Â Â Â Â Â Â Â Â <select id="horse${pi}" ${disabled}>${opts}</select>
Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â Â Â <label>é‡‘é¡
Â Â Â Â Â Â Â Â Â Â <input id="amt${pi}" ${disabled} type="number" inputmode="numeric"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â min="0" step="${p.money>=MIN_BET?STEP:1}" value="${defAmt}">
Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â </div>
Â Â Â Â Â Â <div id="warn${pi}" class="muted" style="margin-top:4px"></div>
Â Â Â Â </div>`;
Â Â });

Â Â document.getElementById("betBox").innerHTML=html;

Â Â ps.forEach((p,pi)=>{
Â Â Â Â const sel=document.getElementById("horse"+pi);
Â Â Â Â if(sel) sel.value=String(defs[pi].horse);
Â Â Â Â validateBet(pi);
Â Â Â Â const amt=document.getElementById("amt"+pi);
Â Â Â Â if(amt) amt.oninput=()=>validateBet(pi);
Â Â });
}

function validateBet(pi){
Â Â const p=state.players[pi];
Â Â const warn=document.getElementById("warn"+pi);
Â Â const amt=document.getElementById("amt"+pi);
Â Â if(!p||!warn||!amt) return;

Â Â if(p.money<=0 || p.dead){ warn.textContent="ã“ã®äººã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™ã€‚"; return; }

Â Â let v=normalizeBet(p.money, amt.value);
Â Â if(v<=0){
Â Â Â Â v=minBetFor(p.money);
Â Â Â Â warn.textContent=`è‡ªå‹•ã§ ${v}å†† ã«ã—ã¾ã—ãŸï¼ˆè³­ã‘å¿…é ˆï¼‰`;
Â Â }else warn.textContent="";
Â Â amt.value=v;
}

/* ãƒ­ãƒƒã‚¯è¡¨ç¤º */
function renderLocked(){
Â Â const box=document.getElementById("lockedBox");
Â Â if(!race.lockedBets.length){
Â Â Â Â box.innerHTML = race.bettingClosed ? `<span class="tag bad">è³­ã‘ãªã—</span>` : "";
Â Â Â Â return;
Â Â }
Â Â const lines=race.lockedBets.map(b=>{
Â Â Â Â return `${state.players[b.pi].name}ï¼š${b.type==="win"?"å˜å‹":"è¤‡å‹"} ${b.horseLabel} ${b.stake}å††ï¼ˆ${b.odd}å€ãƒ­ãƒƒã‚¯ï¼‰`;
Â Â });
Â Â box.innerHTML = `<span class="tag">ğŸ”’ ãƒ­ãƒƒã‚¯æ¸ˆã¿</span><div style="margin-top:6px">${lines.join("<br>")}</div>`;
}

/* =========================
Â Â Â ãƒ¬ãƒ¼ãƒ³æç”»ï¼ˆå³ã«èµ°ã‚‹ï¼‰
========================= */
function renderRaceLanes(){
Â Â let html="";
Â Â race.horses.forEach(h=>{
Â Â Â Â html += `<div class="laneBox">
Â Â Â Â Â Â <div><b>${h.id+1} ${h.name}</b>
Â Â Â Â Â Â Â Â <span class="tag">å˜${h.winOdd}</span><span class="tag">è¤‡${h.placeOdd}</span>
Â Â Â Â Â Â </div>
Â Â Â Â Â Â <div id="track${h.id}" class="track" style="--bgx:0px">
Â Â Â Â Â Â Â Â <div class="finish"></div>
Â Â Â Â Â Â Â Â <div id="label${h.id}" class="label">${h.id+1} ${h.name}</div>
Â Â Â Â Â Â Â Â <div id="horse${h.id}" class="horse">ğŸ</div>
Â Â Â Â Â Â </div>
Â Â Â Â </div>`;
Â Â });
Â Â document.getElementById("race").innerHTML=html;
Â Â race.horses.forEach(h=>{
Â Â Â Â h.p=0; h.lastDisp=0;
Â Â Â Â setHorseX(h.id, 0, 0, true);
Â Â });
}

function setHorseX(id,p01,s01,init=false){
Â Â const x = clamp(p01,0,0.96)*100; // â˜…å·¦â†’å³
Â Â const horse=document.getElementById("horse"+id);
Â Â const label=document.getElementById("label"+id);
Â Â if(!horse||!label) return;

Â Â const bob = init?0:Math.sin((p01*60)+(performance.now()/85))*(2+s01*6);
Â Â const tilt = init?0:(-2+s01*4);
Â Â const scale = 1 + s01*0.06;

Â Â horse.style.left = x+"%";
Â Â horse.style.transform = `translateY(${bob*0.35}px) rotate(${tilt}deg) scale(${scale})`;
Â Â label.style.left = x+"%";
}

/* =========================
Â Â Â ãƒ¬ãƒ¼ã‚¹ä½œæˆ
Â Â Â - é¦¬300é ­ã‹ã‚‰10é ­æŠ½é¸
Â Â Â - äºˆå®šã‚´ãƒ¼ãƒ«æ™‚é–“ finishTime ã‚’ä½œã‚‹ â†’ ãƒ¬ãƒ¼ã‚¹æ™‚é–“ãŒå®‰å®š
========================= */
function pickTenFromPool(){
Â Â const used=new Set();
Â Â const arr=[];
Â Â while(arr.length<N){
Â Â Â Â const idx=rand(HORSE_POOL_SIZE);
Â Â Â Â if(used.has(idx)) continue;
Â Â Â Â used.add(idx);
Â Â Â Â arr.push(idx);
Â Â }
Â Â return arr;
}

function makeCard(){
Â Â stopRace();

Â Â // æŠ½é¸
Â Â const picked = pickTenFromPool();
Â Â race.horses = picked.map((poolIdx, i)=>{
Â Â Â Â const p=state.horsePool[poolIdx];
Â Â Â Â // ãƒ¬ãƒ¼ã‚¹ç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
Â Â Â Â return {
Â Â Â Â Â Â id:i,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // ãƒ¬ãƒ¼ã‚¹å†…ã®é¦¬ç•ª(0-9)
Â Â Â Â Â Â poolId:p.id,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 300é ­ã®ID
Â Â Â Â Â Â name:p.name,
Â Â Â Â Â Â streak:p.streak,
Â Â Â Â Â Â power: p.basePower,
Â Â Â Â Â Â winOdd:0,
Â Â Â Â Â Â placeOdd:0,
Â Â Â Â Â Â // èµ°è¡Œç”¨
Â Â Â Â Â Â p:0,
Â Â Â Â Â Â v:0.06,
Â Â Â Â Â Â lastDisp:0,
Â Â Â Â Â Â fin:false,
Â Â Â Â Â Â finAt:0,
Â Â Â Â Â Â // è¡¨ç¤ºç”¨ã«å°‘ã—å·®
Â Â Â Â Â Â styleTop: 0.9 + Math.random()*0.6,
Â Â Â Â Â Â accel: 1.0 + Math.random()*1.2,
Â Â Â Â };
Â Â });

Â Â // ã‚ªãƒƒã‚ºç”Ÿæˆï¼ˆæ”¹å–„ç‰ˆï¼‰
Â Â makeOddsForRace(race.horses);

Â Â // ãƒ¬ãƒ¼ã‚¹æ¡ä»¶
Â Â race.dist = 1000 + rand(1400);
Â Â renderRaceInfo(race.dist);

Â Â // â˜…äºˆå®šã‚´ãƒ¼ãƒ«æ™‚é–“ï¼ˆã»ã¼15ç§’ã§çµ‚ã‚ã‚‹ï¼‰
Â Â // å¼·ã„ã»ã©å°‘ã—çŸ­ã„ã€å¼±ã„ã»ã©å°‘ã—é•·ã„ã€‚ãŸã ã—â€œå¤§è’ã‚Œâ€ã‚‚ãŸã¾ã«ã€‚
Â Â const chaos = (Math.random() < 0.03); // 3%ã ã‘æ³¢ä¹±
Â Â const powers = race.horses.map(h=>h.power*(1+Math.min(0.12,h.streak*0.03)));
Â Â const minP=Math.min(...powers), maxP=Math.max(...powers);
Â Â const norm = (x)=> (maxP===minP)?0.5 : (x-minP)/(maxP-minP);

Â Â race.finishPlan = race.horses.map(h=>{
Â Â Â Â const p = h.power*(1+Math.min(0.12,h.streak*0.03));
Â Â Â Â const t = norm(p);
Â Â Â Â // å¼·ã„ã»ã©çŸ­ã„ï¼ˆ0.92ã€œ1.05ãã‚‰ã„ï¼‰
Â Â Â Â let base = TARGET_SECONDS * (1.05 - t*0.13);
Â Â Â Â // ä¹±æ•°ï¼ˆÂ±0.6ç§’ç¨‹åº¦ï¼‰
Â Â Â Â base += (Math.random()*2-1) * 0.6;
Â Â Â Â // æ³¢ä¹±ï¼šå¼±ã„é¦¬ãŒãŸã¾ã«çŸ­ããªã‚‹
Â Â Â Â if(chaos && Math.random()<0.25) base -= 0.8*(1-t);

Â Â Â Â return clamp(base, TARGET_SECONDS*0.90, TARGET_SECONDS*1.07);
Â Â });

Â Â race.maxFinish = Math.max(...race.finishPlan);

Â Â // çŠ¶æ…‹
Â Â race.cardReady=true;
Â Â race.bettingClosed=false;
Â Â race.lockedBets=[];
Â Â race.finishOrder=[];
Â Â race.bgx=0; race.startT=null; race.lastT=null;

Â Â // è¡¨ç¤º
Â Â renderOddsTable();
Â Â renderBetUI();
Â Â renderLocked();
Â Â renderRaceLanes();

Â Â document.getElementById("btnStart").disabled=false;
Â Â document.getElementById("btnStart").textContent="ãƒ¬ãƒ¼ã‚¹é–‹å§‹ï¼ˆç· åˆ‡ï¼‰";
Â Â document.getElementById("log").textContent = `å‡ºèµ°è¡¨OKã€‚è³­ã‘ã¦ã‹ã‚‰ã€Œãƒ¬ãƒ¼ã‚¹é–‹å§‹ã€ã€‚${chaos?"ï¼ˆâš ï¸æ³¢ä¹±ã®æ°—é…ï¼‰":""}`;
}

/* =========================
Â Â Â è³­ã‘ãƒ­ãƒƒã‚¯ï¼†ç²¾ç®—æ”¹å–„ï¼ˆãƒªã‚¢ãƒ«å¯„ã‚Šï¼‰
Â Â Â - é–‹å§‹æ™‚ã«è³­ã‘é‡‘ã‚’å…ˆã«å¼•ã
Â Â Â - çš„ä¸­æ™‚ã« (è³­ã‘é‡‘Ã—å€ç‡) ã‚’å—ã‘å–ã‚‹
========================= */
function lockBetsAndDeduct(){
Â Â race.lockedBets=[];
Â Â const ps=state.players;

Â Â ps.forEach((p,pi)=>{
Â Â Â Â if(p.money<=0 || p.dead) return;

Â Â Â Â const type=document.getElementById("type"+pi)?.value ?? "win";
Â Â Â Â const horseId=Number(document.getElementById("horse"+pi)?.value);
Â Â Â Â const amtIn=document.getElementById("amt"+pi)?.value ?? "0";

Â Â Â Â if(!Number.isFinite(horseId) || horseId<0 || horseId>=N) return;

Â Â Â Â let stake=normalizeBet(p.money, amtIn);
Â Â Â Â if(stake<=0) stake=minBetFor(p.money);
Â Â Â Â stake=Math.min(stake, p.money);
Â Â Â Â if(stake<=0) return;

Â Â Â Â // â˜…é–‹å§‹æ™‚ã«å¼•ãï¼ˆãƒªã‚¢ãƒ«å¯„ã‚Šï¼†å–ã‚Šé•ãˆé˜²æ­¢ï¼‰
Â Â Â Â p.money -= stake;

Â Â Â Â const h=race.horses[horseId];
Â Â Â Â const odd=(type==="win")?h.winOdd:h.placeOdd;

Â Â Â Â race.lockedBets.push({
Â Â Â Â Â Â pi,
Â Â Â Â Â Â type,
Â Â Â Â Â Â horseId,
Â Â Â Â Â Â stake,
Â Â Â Â Â Â odd,
Â Â Â Â Â Â horseLabel: `${horseId+1} ${h.name}`
Â Â Â Â });
Â Â });

Â Â // å…¥åŠ›ãƒ­ãƒƒã‚¯
Â Â state.players.forEach((_,pi)=>{
Â Â Â Â ["type","horse","amt"].forEach(prefix=>{
Â Â Â Â Â Â const el=document.getElementById(prefix+pi);
Â Â Â Â Â Â if(el) el.disabled=true;
Â Â Â Â });
Â Â });

Â Â drawPlayers();
Â Â save();
}

/* =========================
Â Â Â ãƒ¬ãƒ¼ã‚¹é€²è¡Œ
Â Â Â - rAFãŒé–“å¼•ã‹ã‚Œã¦ã‚‚ã€ŒçµŒéæ™‚é–“ã€ã§é€²ã‚ã‚‹ â†’ ã»ã¼ä¸€å®šæ™‚é–“ã§çµ‚ã‚ã‚‹
Â Â Â - â€œæ­¢ã¾ã‚‰ãªã„â€æœ€ä½é€Ÿåº¦ï¼šè¡¨ç¤ºå´ã¯ monotonic ã«ã™ã‚‹
========================= */
function startRace(){
Â Â if(!race.cardReady || !race.horses.length || race.raf) return;

Â Â race.bettingClosed=true;

Â Â // è³­ã‘ã‚’è£œæ­£ã—ã¦ãƒ­ãƒƒã‚¯
Â Â state.players.forEach((_,pi)=>validateBet(pi));
Â Â lockBetsAndDeduct();

Â Â if(race.lockedBets.length===0){
Â Â Â Â document.getElementById("log").textContent="è³­ã‘ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
Â Â Â Â race.bettingClosed=false;
Â Â Â Â return;
Â Â }

Â Â renderLocked();
Â Â document.getElementById("btnCard").disabled=true;
Â Â document.getElementById("btnStart").disabled=true;
Â Â document.getElementById("btnStart").textContent="ãƒ¬ãƒ¼ã‚¹ä¸­â€¦";

Â Â // åˆæœŸåŒ–
Â Â race.finishOrder=[];
Â Â race.bgx=0; race.startT=null; race.lastT=null;
Â Â race.horses.forEach(h=>{
Â Â Â Â h.p=0; h.lastDisp=0; h.fin=false; h.finAt=0;
Â Â Â Â setHorseX(h.id,0,0,true);
Â Â });

Â Â document.getElementById("log").textContent = "ãƒ¬ãƒ¼ã‚¹ä¸­â€¦ï¼ˆã‚¿ãƒ–ã‚’è£ã«ã™ã‚‹ã¨å‹•ããŒé…ããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰";
Â Â race.raf = requestAnimationFrame(step);
}

function easeOutCubic(x){ return 1 - Math.pow(1-clamp(x,0,1), 3); }

function step(ts){
Â Â if(!race.startT) race.startT=ts;
Â Â if(!race.lastT) race.lastT=ts;
Â Â const dt=(ts-race.lastT)/1000;
Â Â race.lastT=ts;

Â Â const elapsed=(ts-race.startT)/1000;

Â Â // åœ°é¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå…ˆé ­æƒ³å®šã®ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿï¼‰
Â Â // äºˆå®šã‚´ãƒ¼ãƒ«ã‹ã‚‰æ¨å®šé€Ÿåº¦ã‚’ä½œã‚‹
Â Â const leaderEst = 1/Math.max(1, Math.min(...race.finishPlan));
Â Â race.bgx -= (leaderEst*1100)*dt;

Â Â race.horses.forEach(h=>{
Â Â Â Â const tr=document.getElementById("track"+h.id);
Â Â Â Â if(tr) tr.style.setProperty("--bgx", `${race.bgx}px`);
Â Â });

Â Â // å„é¦¬ã®é€²æ—ï¼ˆæ™‚é–“ãƒ™ãƒ¼ã‚¹ï¼‰ï¼‹è¦‹ãŸç›®æºã‚Œï¼ˆå¿…ãšå˜èª¿å¢—åŠ ï¼‰
Â Â let finished=0;
Â Â for(const h of race.horses){
Â Â Â Â const finT = race.finishPlan[h.id];
Â Â Â Â let base = easeOutCubic(elapsed / finT);

Â Â Â Â // è¦‹ãŸç›®ã®å°ã•ãªæºã‚Œï¼ˆé€²è¡Œã®å¾ŒåŠã»ã©æ¸›ã‚‹ï¼‰
Â Â Â Â const wob = (Math.random()*2-1) * 0.012 * (1-base);
Â Â Â Â let disp = clamp(base + wob, 0, 1);

Â Â Â Â // â˜…çµ¶å¯¾ã«å¾Œé€€ã—ãªã„ï¼ˆæ­¢ã¾ã‚‰ãªã„ã®ä¿è¨¼ï¼‰
Â Â Â Â disp = Math.max(disp, h.lastDisp + 0.0006); // æœ€ä½å¢—åˆ†
Â Â Â Â if(disp>1) disp=1;
Â Â Â Â h.lastDisp = disp;

Â Â Â Â // é€Ÿåº¦ã£ã½ã•ï¼ˆè¡¨ç¤ºã®æºã‚Œå¼·ã•ï¼‰
Â Â Â Â const s01 = clamp(1/finT / (1/TARGET_SECONDS) * 0.6, 0, 1);

Â Â Â Â setHorseX(h.id, disp, s01);

Â Â Â Â if(disp>=1 && !h.fin){
Â Â Â Â Â Â h.fin=true;
Â Â Â Â Â Â h.finAt=performance.now();
Â Â Â Â Â Â race.finishOrder.push(h.id);
Â Â Â Â }
Â Â Â Â if(disp>=1) finished++;
Â Â }

Â Â if(finished>=N || elapsed>=race.maxFinish+0.35){
Â Â Â Â finishRace();
Â Â Â Â return;
Â Â }

Â Â race.raf = requestAnimationFrame(step);
}

/* =========================
Â Â Â çµ‚äº†ï¼†ç²¾ç®—
========================= */
function finishRace(){
Â Â stopRace();

Â Â // é †ä½ç¢ºå®šï¼šfinAtã®æ—©ã„é †ï¼ˆç¢ºå®Ÿï¼‰
Â Â const ordered = [...race.horses].sort((a,b)=>a.finAt-b.finAt);
Â Â const first=ordered[0], second=ordered[1], third=ordered[2];
Â Â const top3=new Set([first.id, second.id, third.id]);

Â Â // ç²¾ç®—ï¼šé–‹å§‹æ™‚ã«è³­ã‘é‡‘ã‚’å¼•ã„ã¦ã‚ã‚‹ã®ã§ã€çš„ä¸­ã—ãŸã‚‰æ‰•æˆ»ã‚’åŠ ç®—ã™ã‚‹ã ã‘
Â Â let out="ğŸ çµæœ\n";
Â Â ordered.forEach((h,i)=>out += `${i+1}ç€ï¼š${h.id+1} ${h.name}\n`);

Â Â out += `\nã€ç²¾ç®—ã€‘é–‹å§‹æ™‚ã«è³­ã‘é‡‘ã‚’å¼•ã„ã¦ã„ã¾ã™ã€‚çš„ä¸­ã—ãŸã‚‰ (è³­ã‘é‡‘Ã—å€ç‡) ãŒæˆ»ã‚Šã¾ã™ã€‚\n`;

Â Â const ps=state.players;
Â Â let noteParts=[];

Â Â for(const b of race.lockedBets){
Â Â Â Â const p=ps[b.pi];
Â Â Â Â if(!p || p.dead) continue;

Â Â Â Â const hit = (b.type==="win") ? (b.horseId===first.id) : top3.has(b.horseId);

Â Â Â Â if(hit){
Â Â Â Â Â Â const payout = yen(b.stake * b.odd);
Â Â Â Â Â Â p.money += payout;
Â Â Â Â Â Â out += `ãƒ»${p.name}ï¼š${b.type==="win"?"å˜å‹":"è¤‡å‹"} ${b.horseLabel} ${b.stake}å†† â†’ çš„ä¸­ï¼ æ‰•æˆ» ${payout}å††ï¼ˆ${b.odd}å€ï¼‰\n`;
Â Â Â Â Â Â noteParts.push(`${p.name}çš„ä¸­`);
Â Â Â Â }else{
Â Â Â Â Â Â out += `ãƒ»${p.name}ï¼š${b.type==="win"?"å˜å‹":"è¤‡å‹"} ${b.horseLabel} ${b.stake}å†† â†’ ãƒã‚ºãƒ¬\n`;
Â Â Â Â }

Â Â Â Â if(p.money<=0){
Â Â Â Â Â Â p.money=0; p.dead=true;
Â Â Â Â Â Â out += `Â Â â†’ ${p.name} ã¯ 0å††ã§ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼\n`;
Â Â Â Â }
Â Â }

Â Â // é¦¬æˆç¸¾ï¼ˆpoolã«åæ˜ ï¼‰
Â Â // å‡ºèµ°ã—ãŸé¦¬ã¯runs++ã€å‹ã£ãŸé¦¬ã¯wins++ã¨streak++ã€è² ã‘ãŸé¦¬ã¯streak=0
Â Â const winnerPoolId = race.horses[first.id].poolId;
Â Â const ranPoolIds = race.horses.map(h=>h.poolId);

Â Â ranPoolIds.forEach(pid=>{
Â Â Â Â const hp=state.horsePool[pid];
Â Â Â Â if(!hp) return;
Â Â Â Â hp.runs++;
Â Â Â Â if(pid===winnerPoolId){
Â Â Â Â Â Â hp.wins++;
Â Â Â Â Â Â hp.streak++;
Â Â Â Â }else{
Â Â Â Â Â Â hp.streak=0;
Â Â Â Â }
Â Â });

Â Â // å±¥æ­´ä¿å­˜
Â Â const top3Labels = [first,second,third].map(h=>`${h.id+1} ${h.name}`);
Â Â state.history.push({
Â Â Â Â when: nowStr(),
Â Â Â Â top3: top3Labels,
Â Â Â Â note: noteParts.length ? noteParts.join(" / ") : "çš„ä¸­ãªã—"
Â Â });
Â Â if(state.history.length > 60) state.history = state.history.slice(-60);

Â Â // UIæ›´æ–°
Â Â document.getElementById("log").textContent=out;
Â Â drawPlayers();
Â Â renderHistory();
Â Â save();

Â Â // æ¬¡ã«å‚™ãˆã‚‹
Â Â race.cardReady=false;
Â Â race.bettingClosed=false;
Â Â race.lockedBets=[];
Â Â document.getElementById("btnCard").disabled=false;
Â Â document.getElementById("btnStart").disabled=true;
Â Â document.getElementById("btnStart").textContent="ãƒ¬ãƒ¼ã‚¹é–‹å§‹ï¼ˆç· åˆ‡ï¼‰";
}

/* =========================
Â Â Â åœæ­¢/ãƒªã‚»ãƒƒãƒˆ
========================= */
function stopRace(){
Â Â if(race.raf){ cancelAnimationFrame(race.raf); race.raf=null; }
Â Â race.startT=null; race.lastT=null;
}

function resetAll(){
Â Â stopRace();
Â Â try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
Â Â location.reload();
}

/* =========================
Â Â Â ã‚¿ãƒ–è£ã®æ³¨æ„è¡¨ç¤º
========================= */
document.addEventListener("visibilitychange", ()=>{
Â Â const t=document.getElementById("hiddenTag");
Â Â if(!t) return;
Â Â t.style.display = document.hidden ? "inline-block" : "none";
});
</script>
</body>
</html>
